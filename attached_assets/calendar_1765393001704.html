<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scheduling Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-bg: #0E2148;
      --accent-1: #f30059;
      --accent-2: #7965C1;
      --text-highlight: #E3D095;
      --card-bg: rgba(14, 33, 72, 0.85);
      --border-color: rgba(121, 101, 193, 0.4);
    }

    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      overflow-x: hidden;
      background: var(--primary-bg);
      background-attachment: fixed;
      min-height: 100vh;
      color: white;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    /* Animated Background Pattern */
    .background-pattern {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.1;
      z-index: 0;
      pointer-events: none;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(121, 101, 193, 0.2) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(243, 0, 89, 0.2) 0%, transparent 20%),
        repeating-linear-gradient(45deg, transparent, transparent 30px, rgba(121, 101, 193, 0.1) 30px, rgba(121, 101, 193, 0.1) 60px);
    }

    /* Topbar */
    .topbar {
      position: sticky;
      top: 0;
      width: 100%;
      height: 70px;
      background: rgba(14, 33, 72, 0.95);
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      z-index: 1000;
      transition: all 0.3s ease;
      border-bottom: 1px solid var(--border-color);
    }

    .topbar-logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--accent-2), var(--accent-1));
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(121, 101, 193, 0.4); }
      70% { box-shadow: 0 0 0 15px rgba(121, 101, 193, 0); }
      100% { box-shadow: 0 0 0 0 rgba(121, 101, 193, 0); }
    }

    .logo-icon img {
      width: 30px;
      height: 30px;
      filter: brightness(0) invert(1);
    }

    .topbar-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-highlight);
      letter-spacing: 1.5px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* Main Container */
    .main-container {
      display: flex;
      width: 100%;
      position: relative;
      z-index: 1;
    }

    /* Content Area */
    .content-area {
      flex: 1;
      padding: 40px;
      transition: all 0.3s ease;
    }

    .content-card {
      background: var(--card-bg);
      backdrop-filter: blur(25px);
      border-radius: 25px;
      padding: 20px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-color);
      min-height: 700px;
      position: relative;
      overflow: hidden;
    }

    .content-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(121, 101, 193, 0.1) 0%, transparent 70%);
      transform: rotate(30deg);
      z-index: -1;
    }

    .content-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 3px solid var(--border-color);
      flex-wrap: wrap;
      gap: 25px;
    }

    .content-title {
      font-size: 32px;
      font-weight: 800;
      color: var(--text-highlight);
      display: flex;
      align-items: center;
      gap: 15px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .content-title i {
      color: var(--accent-1);
      font-size: 36px;
    }

    .search-form {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 40px;
      padding: 12px 25px;
      transition: all 0.3s ease;
      border: 2px solid var(--border-color);
      min-width: 300px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .search-form:focus-within {
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      transform: scale(1.02);
      border-color: var(--accent-2);
    }

    .search-icon {
      width: 24px;
      height: 24px;
      margin-right: 12px;
      color: var(--text-highlight);
    }

    .search-input {
      flex: 1;
      border: none;
      background: transparent;
      color: var(--text-highlight);
      font-size: 16px;
      font-weight: 500;
      outline: none;
    }

    .search-input::placeholder {
      color: rgba(227, 208, 149, 0.7);
    }

    /* Table Styles */
    .contacts-table-container {
      overflow-x: auto;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .contacts-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      overflow: hidden;
    }

    .contacts-table th {
      background: linear-gradient(135deg, var(--accent-2), #483AA0);
      color: white;
      text-align: left;
      padding: 12px 15px;
      font-weight: 500;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
    }

    .contacts-table th::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }

    .contacts-table th:hover::after {
      left: 100%;
    }

    .contacts-table td {
      padding: 10px 15px;
      color: var(--text-highlight);
      font-size: 14px;
      font-weight: 400;
      border-bottom: 1px solid rgba(121, 101, 193, 0.2);
    }

    .contacts-table tr:last-child td {
      border-bottom: none;
    }

    .contacts-table tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.03);
    }

    .contacts-table tr:hover {
      background: rgba(121, 101, 193, 0.2);
      transform: scale(1.01);
      transition: all 0.3s ease;
    }

    .contacts-table td i {
      margin-right: 5px;
      color: var(--accent-1);
    }

    /* Stats Cards */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: rgba(121, 101, 193, 0.15);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      backdrop-filter: blur(15px);
      border: 1px solid var(--border-color);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      background: rgba(121, 101, 193, 0.25);
    }

    .stat-icon {
      font-size: 25px;
      margin-bottom: 4px;
      color: var(--accent-1);
    }

    .stat-value {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-highlight);
      margin-bottom: 5px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .stat-label {
      font-size: 14px;
      color: rgba(227, 208, 149, 0.85);
      font-weight: 600;
    }

    /* Footer */
    .main-footer {
      width: 100%;
      padding: 8px;
      background: linear-gradient(135deg, var(--accent-2), #483AA0);
      border-top: 1px solid var(--border-color);
      text-align: center;
      position: sticky;
      bottom: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .footer-text {
      font-size: 13px;
      color: white;
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    /* Loading Spinner */
    .loading {
      text-align: center;
      padding: 60px;
      color: var(--text-highlight);
      font-size: 20px;
      font-weight: 600;
    }

    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(121, 101, 193, 0.3);
      border-top-color: var(--accent-1);
      border-radius: 50%;
      animation: spin 1.2s linear infinite;
      margin: 0 auto 25px;
      box-shadow: 0 0 20px rgba(243, 0, 89, 0.3);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Calendar Styles */
    .calendar-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      grid-template-rows: auto 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .calendar-widget {
      grid-column: 1;
      grid-row: 1 / span 2;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .calendar-nav {
      background: rgba(121, 101, 193, 0.2);
      border: none;
      color: var(--text-highlight);
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .calendar-nav:hover {
      background: rgba(121, 101, 193, 0.4);
    }

    .calendar-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-highlight);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .calendar-day-header {
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      color: var(--text-highlight);
      padding: 8px 0;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .calendar-day:not(.empty):hover {
      background: rgba(121, 101, 193, 0.3);
    }

    .calendar-day.empty {
      background: transparent;
    }

    .calendar-day.today {
      background: linear-gradient(135deg, var(--accent-1), #d4004d);
      color: white;
      font-weight: bold;
    }

    .calendar-day.has-event::after {
      content: '';
      position: absolute;
      bottom: 3px;
      width: 6px;
      height: 6px;
      background: #ff9e00;
      border-radius: 50%;
    }

    .calendar-day.has-task::after {
      content: '';
      position: absolute;
      bottom: 3px;
      width: 6px;
      height: 6px;
      background: #00c3ff;
      border-radius: 50%;
    }

    .calendar-day.has-event.has-task::after {
      content: '';
      position: absolute;
      bottom: 3px;
      width: 6px;
      height: 6px;
      background: #ff00aa;
      border-radius: 50%;
    }

    /* Event/Activity Table */
    .event-table-container {
      grid-column: 2;
      grid-row: 1;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .event-table-header {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-highlight);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(255, 100, 50, 0.5);
    }

    .event-table {
      width: 100%;
      border-collapse: collapse;
    }

    .event-table th {
      background: linear-gradient(135deg, #ff6b35, #f7931e);
      color: white;
      text-align: left;
      padding: 10px 12px;
      font-weight: 500;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .event-table td {
      padding: 10px 12px;
      color: var(--text-highlight);
      font-size: 13px;
      border-bottom: 1px solid rgba(255, 100, 50, 0.2);
    }

    .event-table tr:nth-child(even) {
      background: rgba(255, 100, 50, 0.05);
    }

    .event-table tr:hover {
      background: rgba(255, 100, 50, 0.15);
    }

    /* Task Table */
    .task-table-container {
      grid-column: 1 / span 2;
      grid-row: 2;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    }

    .task-table-header {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-highlight);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(155, 89, 182, 0.5);
    }

    .task-table {
      width: 100%;
      border-collapse: collapse;
    }

    .task-table th {
      background: linear-gradient(135deg, #9b59b6, #8e44ad);
      color: white;
      text-align: left;
      padding: 10px 12px;
      font-weight: 500;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .task-table td {
      padding: 10px 12px;
      color: var(--text-highlight);
      font-size: 13px;
      border-bottom: 1px solid rgba(155, 89, 182, 0.2);
    }

    .task-table tr:nth-child(even) {
      background: rgba(155, 89, 182, 0.05);
    }

    .task-table tr:hover {
      background: rgba(155, 89, 182, 0.15);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .content-area {
        padding: 30px;
      }
      
      .content-card {
        padding: 30px;
      }
      
      .content-title {
        font-size: 28px;
      }
      
      .search-form {
        min-width: 250px;
      }
      
      .calendar-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }
      
      .calendar-widget {
        grid-column: 1;
        grid-row: 1;
      }
      
      .event-table-container {
        grid-column: 1;
        grid-row: 2;
      }
      
      .task-table-container {
        grid-column: 1;
        grid-row: 3;
      }
    }

    @media (max-width: 768px) {
      .content-area {
        padding: 20px;
      }
      
      .topbar {
        padding: 0 20px;
        height: 60px;
      }
      
      .topbar-title {
        font-size: 20px;
      }
      
      .logo-icon {
        width: 40px;
        height: 40px;
      }
      
      .content-card {
        padding: 15px;
      }
      
      .content-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
      }
      
      .content-title {
        font-size: 24px;
      }
      
      .search-form {
        width: 100%;
        min-width: auto;
      }
      
      .stats-container {
        grid-template-columns: 1fr 1fr;
      }
      
      .contacts-table th,
      .contacts-table td {
        padding: 8px 10px;
        font-size: 13px;
      }
    }

    @media (max-width: 480px) {
      .topbar-title {
        display: none;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .contacts-table {
        font-size: 12px;
      }
      
      .contacts-table th,
      .contacts-table td {
        padding: 6px 8px;
      }
      
      .content-title {
        font-size: 20px;
      }
      
      .stat-value {
        font-size: 18px;
      }
      
      .calendar-grid {
        gap: 3px;
      }
      
      .calendar-day {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="background-pattern"></div>
  
  <!-- Topbar -->
  <header class="topbar">
    <div class="topbar-logo">
      <div class="logo-icon">
                <a href="index.html" class="flex items-center">
                    <img src="https://res.cloudinary.com/dedcmctqk/image/upload/v1750079276/logome_h9snnx.webp" alt="MDRRMO" class="h-12 w-auto">
                </a>
      </div>
      <h1 class="topbar-title" id="topbar-title">SCHEDULING DASHBOARD</h1>
    </div>
  </header>
  
  <div class="main-container">
    <!-- Content Area -->
    <main class="content-area" id="content-area">
      <div class="content-card">
        <div class="content-header">
          <h2 class="content-title">
            <i class="fas fa-tasks"></i>
            Activity & Task Schedule
          </h2>
          <form class="search-form" id="search-form">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="search-input" placeholder="Search schedules...">
          </form>
        </div>

        <!-- Calendar and Tables Container -->
        <div class="calendar-container">
          <!-- Calendar Widget -->
          <div class="calendar-widget">
            <div class="calendar-header">
              <button class="calendar-nav" id="prev-month">
                <i class="fas fa-chevron-left"></i>
              </button>
              <div class="calendar-title" id="calendar-title">June 2024</div>
              <button class="calendar-nav" id="next-month">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
            <div class="calendar-grid" id="calendar-grid">
              <!-- Calendar will be generated here -->
            </div>
          </div>

          <!-- Event/Activity Schedule Table -->
          <div class="event-table-container">
            <div class="event-table-header">
              <i class="fas fa-calendar-day"></i> EVENT/ACTIVITY SCHEDULE
            </div>
            <div class="contacts-table-container">
              <table class="event-table" id="event-table">
                <thead>
                  <tr>
                    <th>Event Name</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Location</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody id="event-table-body">
                  <!-- Event data will be populated here -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Task Schedule Table -->
          
      </div>
      <div class="task-table-container">
            <div class="task-table-header">
              <i class="fas fa-list-check"></i> TASK SCHEDULE
            </div>
            <div class="contacts-table-container">
              <table class="task-table" id="task-table">
                <thead>
                  <tr>
                    <th>Task Name</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Deadline Date</th>
                    <th>Deadline Time</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody id="task-table-body">
                  <!-- Task data will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
    </main>
  </div>
  
  <!-- Footer -->
  <footer class="main-footer">
    <div class="footer-text" id="footer-text">
      <i class="fas fa-copyright"></i> 2024 Scheduling Dashboard. All rights reserved.
    </div>
  </footer>
  
  <script>
    // Google Sheet CSV URL
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSf1W59_eUCMCHw-wE_T71iUZB8cjPasixLJs3RO2RvHaxK48LdPp_LUpxiwbTQWoYrBmagtKrirAq8/pub?gid=0&single=true&output=csv";

    // Default configuration
    const defaultConfig = {
      page_title: "SCHEDULING DASHBOARD",
      footer_text: "2024 Scheduling Dashboard. All rights reserved.",
      background_color: "#0E2148",
      surface_color: "#99005e",
      text_color: "#E3D095",
      primary_action_color: "#f30059",
      secondary_action_color: "#871239",
      font_family: "Inter, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, sans-serif",
      font_size: 16
    };

    // Global variables
    let eventData = [];
    let taskData = [];
    let currentDate = new Date();
    let eventDates = new Set();
    let taskDates = new Set();

    // CSV parsing function
    function parseCSV(csvText) {
      const lines = csvText.trim().split('\n');
      const headers = lines[0].split(',').map(header => header.trim().replace(/"/g, ''));
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const values = lines[i].split(',').map(value => value.trim().replace(/"/g, ''));
        if (values.length === headers.length) {
          const row = {};
          headers.forEach((header, index) => {
            row[header] = values[index];
          });
          data.push(row);
        }
      }

      return data;
    }

    // Fetch data from Google Sheet
    async function fetchData() {
      try {
        const response = await fetch(SHEET_CSV_URL);
        const csvText = await response.text();
        const data = parseCSV(csvText);
        
        // Separate event and task data
        eventData = data.filter(row => row['Event-Name'] && row['Event-Date']);
        taskData = data.filter(row => row['Task-Name'] && row['Task-Date']);
        
        // Collect unique dates for calendar highlighting
        eventData.forEach(event => {
          if (event['Event-Date']) {
            eventDates.add(event['Event-Date']);
          }
        });
        
        taskData.forEach(task => {
          if (task['Task-Date']) {
            taskDates.add(task['Task-Date']);
          }
        });
        
        populateTables();
        renderCalendar();
      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    // Populate tables with data
    function populateTables() {
      const eventTableBody = document.getElementById('event-table-body');
      const taskTableBody = document.getElementById('task-table-body');
      
      // Clear existing data
      eventTableBody.innerHTML = '';
      taskTableBody.innerHTML = '';
      
      // Populate event table
      eventData.forEach(event => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${event['Event-Name'] || ''}</td>
          <td>${event['Event-Date'] || ''}</td>
          <td>${event['Event-Time'] || ''}</td>
          <td>${event['Event-Location'] || ''}</td>
          <td>${event['Notes'] || ''}</td>
        `;
        eventTableBody.appendChild(row);
      });
      
      // Populate task table
      taskData.forEach(task => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${task['Task-Name'] || ''}</td>
          <td>${task['Task-Date'] || ''}</td>
          <td>${task['Task-Time'] || ''}</td>
          <td>${task['Deadline-Date'] || ''}</td>
          <td>${task['Deadline-Time'] || ''}</td>
          <td>${task['Description'] || ''}</td>
        `;
        taskTableBody.appendChild(row);
      });
    }

    // Render calendar
    function renderCalendar() {
      const calendarGrid = document.getElementById('calendar-grid');
      const calendarTitle = document.getElementById('calendar-title');
      
      // Clear existing calendar
      calendarGrid.innerHTML = '';
      
      // Set calendar title
      calendarTitle.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${currentDate.getFullYear()}`;
      
      // Create day headers
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      days.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day-header';
        dayHeader.textContent = day;
        calendarGrid.appendChild(dayHeader);
      });
      
      // Get first day of month and number of days
      const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
      const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
      
      // Add empty cells for days before the first day
      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day empty';
        calendarGrid.appendChild(emptyCell);
      }
      
      // Add cells for each day of the month
      const today = new Date();
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-day';
        dayCell.textContent = day;
        
        // Check if it's today
        if (currentDate.getFullYear() === today.getFullYear() && 
            currentDate.getMonth() === today.getMonth() && 
            day === today.getDate()) {
          dayCell.classList.add('today');
        }
        
        // Check for events and tasks
        const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const hasEvent = eventDates.has(dateStr);
        const hasTask = taskDates.has(dateStr);
        
        if (hasEvent && hasTask) {
          dayCell.classList.add('has-event', 'has-task');
        } else if (hasEvent) {
          dayCell.classList.add('has-event');
        } else if (hasTask) {
          dayCell.classList.add('has-task');
        }
        
        calendarGrid.appendChild(dayCell);
      }
    }

    // Navigation functions
    function navigateMonth(direction) {
      currentDate.setMonth(currentDate.getMonth() + direction);
      renderCalendar();
    }

    // Search functionality
    function filterSchedules(searchTerm) {
      const eventRows = document.querySelectorAll('#event-table-body tr');
      const taskRows = document.querySelectorAll('#task-table-body tr');
      
      const term = searchTerm.toLowerCase();
      
      eventRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? '' : 'none';
      });
      
      taskRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(term) ? '' : 'none';
      });
    }

    // Attach event listeners
    function attachEventListeners() {
      const searchForm = document.getElementById("search-form");
      const searchInput = document.getElementById("search-input");
      const prevMonthBtn = document.getElementById("prev-month");
      const nextMonthBtn = document.getElementById("next-month");

      if (searchForm) searchForm.addEventListener("submit", e => e.preventDefault());
      if (searchInput) searchInput.addEventListener("input", e => filterSchedules(e.target.value));
      if (prevMonthBtn) prevMonthBtn.addEventListener("click", () => navigateMonth(-1));
      if (nextMonthBtn) nextMonthBtn.addEventListener("click", () => navigateMonth(1));
    }

    // Configuration change handler
    function onConfigChange(config) {
      const topbarTitle = document.getElementById("topbar-title");
      const footerText = document.getElementById("footer-text");

      if (topbarTitle) topbarTitle.textContent = config.page_title || defaultConfig.page_title;
      if (footerText) footerText.innerHTML = `<i class="fas fa-copyright"></i> ${config.footer_text || defaultConfig.footer_text}`;

      const customFont = config.font_family || defaultConfig.font_family;
      document.body.style.fontFamily = customFont;

      const bgColor = config.background_color || defaultConfig.background_color;
      document.body.style.background = bgColor;

      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      document.documentElement.style.setProperty('--primary-bg', bgColor);
      document.documentElement.style.setProperty('--accent-1', primaryColor);
      document.documentElement.style.setProperty('--accent-2', secondaryColor);
      document.documentElement.style.setProperty('--text-highlight', textColor);

      const baseSize = config.font_size || defaultConfig.font_size;
      if (topbarTitle) topbarTitle.style.fontSize = `${baseSize * 1.5}px`;
    }

    // Initialize the application
    function init() {
      attachEventListeners();
      fetchData();
      onConfigChange(defaultConfig);
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>